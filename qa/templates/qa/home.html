<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Course Buddy</title>
  <style>
  * {
    box-sizing: border-box;
  }
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    min-height: 100vh;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #0f172a, #1e293b);
    color: #0f172a;
  }
  .card {
    width: 100%;
    max-width: 760px;
    background: #ffffff;
    border-radius: 18px;
    padding: 24px 26px 28px;
    box-shadow: 0 20px 60px rgba(15, 23, 42, 0.35);
  }
  h1 {
    margin: 0 0 4px;
    font-size: 1.8rem;
  }
  .subtitle {
    margin: 0 0 18px;
    font-size: 0.9rem;
    color: #64748b;
  }
  textarea {
    width: 100%;
    min-height: 90px;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid #cbd5e1;
    font-size: 0.95rem;
    resize: vertical;
  }
  textarea:focus {
    outline: none;
    border-color: #2563eb;
    box-shadow: 0 0 0 1px #2563eb22;
  }
  .actions {
    margin-top: 10px;
    display: flex;
    gap: 8px;
    align-items: center;
  }
  button {
    padding: 8px 18px;
    border-radius: 999px;
    border: none;
    cursor: pointer;
    font-size: 0.95rem;
    background: #2563eb;
    color: white;
    font-weight: 500;
  }
  button:disabled {
    opacity: 0.6;
    cursor: default;
  }
  #loading {
    display: none;
    font-size: 0.9rem;
    color: #64748b;
  }
  #loading::after {
    content: " ";
    display: inline-block;
    width: 10px;
    height: 10px;
    margin-left: 6px;
    border-radius: 50%;
    border: 2px solid #93c5fd;
    border-top-color: transparent;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  #answer-wrapper {
    margin-top: 20px;
    padding-top: 14px;
    border-top: 1px solid #e2e8f0;
  }
  #answer-label {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: #94a3b8;
    margin-bottom: 4px;
  }
  #answer {
    white-space: pre-wrap;
    font-size: 0.95rem;
  }
  #sources {
    margin-top: 10px;
    font-size: 0.8rem;
    color: #64748b;
  }
  .error {
    color: #b91c1c;
    margin-top: 10px;
    font-size: 0.9rem;
  }
</style>

</head>
<body>
  <div class="card">
    <h1>Course Buddy</h1>
    <p>Ask something about your CCE program, courses, or schedule.</p>

    <form id="qa-form">
      <textarea id="question" placeholder="E.g. What should I take in spring of second year?"></textarea>
      <button type="submit" id="ask-btn">Ask</button>
    </form>

    <div id="loading">Thinking…</div>
    <div id="error" class="error"></div>
    <div id="answer-wrapper" style="display:none;">
        <div id="answer-label">Answer</div>
        <div id="answer"></div>
        <div id="sources"></div>
    </div>

  </div>

<script>
  const form = document.getElementById("qa-form");
  const questionInput = document.getElementById("question");
  const loading = document.getElementById("loading");
  const answerDiv = document.getElementById("answer");
  const answerWrapper = document.getElementById("answer-wrapper");
  const sourcesDiv = document.getElementById("sources");
  const errorDiv = document.getElementById("error");
  const askBtn = document.getElementById("ask-btn");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const question = questionInput.value.trim();
    if (!question) {
      errorDiv.textContent = "Please enter a question.";
      return;
    }
    errorDiv.textContent = "";
    answerDiv.textContent = "";
    sourcesDiv.textContent = "";
    answerWrapper.style.display = "none";
    loading.style.display = "inline-flex";
    askBtn.disabled = true;

    try {
      const resp = await fetch(window.location.pathname, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ question }),
      });

      const data = await resp.json();
      if (!resp.ok || data.error) {
        errorDiv.textContent = data.error || "Something went wrong.";
      } else {
        answerDiv.textContent = data.answer || "(No answer returned)";

        if (data.sources && data.sources.length) {
          const items = data.sources.map((s, i) => `• ${s.slice(0, 200)}…`);
          sourcesDiv.innerHTML =
            "<strong>Sources:</strong><br>" + items.join("<br>");
        } else {
          sourcesDiv.textContent = "";
        }
        answerWrapper.style.display = "block";
      }
    } catch (err) {
      console.error(err);
      errorDiv.textContent = "Network error. Try again.";
    } finally {
      loading.style.display = "none";
      askBtn.disabled = false;
    }
  });
</script>

</body>
</html>
